<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8" />
<title>QKDE Cosmology Tools – Interactive Calculator Suite</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ================= MATHJAX ================= -->
<script>
  window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<!-- ================= CHART.JS ================= -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



  

<style>
:root {
  --bg-body: #020713;
  --bg-page: rgba(12,18,28,0.9);
  --bg-card: rgba(12,18,28,0.82);
  --bg-card-wide: rgba(12,18,28,0.88);
  --bg-input: rgba(5,10,18,0.9);
  --bg-output: rgba(0,0,0,0.55);
  --bg-formula: rgba(8,12,20,0.95);

  --border-card: rgba(102,252,241,0.14);
  --border-card-wide: rgba(102,252,241,0.18);
  --border-input: rgba(120,160,190,0.7);
  --border-output: rgba(120,160,190,0.36);
  --border-formula: rgba(120,160,190,0.45);

  --text-main: #e8e9ef;
  --text-muted: #c0d6f5;
  --text-accent: #66fcf1;
  --text-heading: #bfe9ff;
  --text-heading-strong: #d6f7ff;

  --chip-bg: rgba(8,14,22,0.95);
  --chip-border: rgba(160,220,255,0.5);
  --chip-bg-active1: #66fcf1;
  --chip-bg-active2: #45b9d9;
  --chip-text-active: #031016;

  --btn-bg1: #d2f2ff;
  --btn-bg2: #bfe6f7;
  --btn-border: rgba(200,240,255,0.8);

  --shadow-card: 0 0 35px rgba(102,252,241,0.15);
  --shadow-inner: inset 0 0 18px rgba(102,252,241,0.06);

  --error-bg: rgba(70,0,10,0.7);
  --error-text: #ffe6e6;

  --link-color: #66fcf1;
}

/* Light theme overrides */
:root[data-theme="light"] {
  --bg-body: #f6f7fb;
  --bg-page: #ffffff;
  --bg-card: #f9fbff;
  --bg-card-wide: #f9fbff;
  --bg-input: #ffffff;
  --bg-output: #f2f4fb;
  --bg-formula: #f5f7ff;

  --border-card: rgba(20,60,120,0.10);
  --border-card-wide: rgba(20,60,120,0.18);
  --border-input: rgba(120,160,190,0.7);
  --border-output: rgba(120,160,190,0.36);
  --border-formula: rgba(120,160,190,0.45);

  --text-main: #1b2540;
  --text-muted: #4b5a7a;
  --text-accent: #0077aa;
  --text-heading: #133a67;
  --text-heading-strong: #0f2b4b;

  --chip-bg: #ffffff;
  --chip-border: rgba(30,80,140,0.4);
  --chip-bg-active1: #0f9bdc;
  --chip-bg-active2: #16c3c6;
  --chip-text-active: #ffffff;

  --btn-bg1: #0f9bdc;
  --btn-bg2: #16c3c6;
  --btn-border: rgba(0,120,190,0.8);

  --shadow-card: 0 10px 24px rgba(15, 50, 90, 0.15);
  --shadow-inner: inset 0 0 0 rgba(0,0,0,0);

  --error-bg: rgba(220,40,40,0.12);
  --error-text: #7a0012;

  --link-color: #0f9bdc;
}

/* ---- Global background + typography ---- */
body {
  background: var(--bg-body);
  margin: 0;
  padding: 0;
  color: var(--text-main);
  font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  line-height: 1.6;
}

/* ================= HEADER ================= */
.site-header {
  max-width: 1100px;
  margin: 16px auto 0;
  padding: 10px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.site-header-left {
  display: flex;
  align-items: center;
  gap: 10px;
}

.site-header a {
  color: var(--link-color);
  font-size: 0.9rem;
  text-decoration: none;
  padding: 6px 12px;
  border-radius: 999px;
  border: 1px solid rgba(102,252,241,0.3);
}

:root[data-theme="light"] .site-header a {
  border-color: rgba(0,120,190,0.35);
}

.site-header a:hover {
  background: rgba(102,252,241,0.15);
}

:root[data-theme="light"] .site-header a:hover {
  background: rgba(15,155,220,0.08);
}

/* Theme toggle button */
.theme-toggle {
  border-radius: 999px;
  border: 1px solid rgba(102,252,241,0.3);
  background: transparent;
  color: var(--text-main);
  font-size: 0.85rem;
  padding: 6px 14px;
  cursor: pointer;
}
.theme-toggle:hover {
  background: rgba(102,252,241,0.14);
}

:root[data-theme="light"] .theme-toggle {
  border-color: rgba(0,120,190,0.35);
}
:root[data-theme="light"] .theme-toggle:hover {
  background: rgba(15,155,220,0.08);
}

/* ================= MAIN PAGE WRAPPER ================= */
.page {
  max-width: 1100px;
  margin: 8px auto 32px;
  padding: 28px 24px 32px;
  background: var(--bg-page);
  border-radius: 18px;
  border: 1px solid var(--border-card);
  box-shadow: var(--shadow-card);
  backdrop-filter: blur(10px);
}

/* ---- Header ---- */
h1 {
  text-align: center;
  font-family: "Merriweather", Georgia, serif;
  font-weight: 300;
  font-size: 2rem;
  color: var(--text-heading);
  margin-bottom: 6px;
}
h2, h3, h4 {
  font-family: "Merriweather", Georgia, serif;
  font-weight: 300;
  color: var(--text-heading);
}

.center { text-align: center; }

.calc-intro {
  font-size: 0.95rem;
  opacity: 0.95;
  margin-bottom: 18px;
  max-width: 860px;
  margin-left: auto;
  margin-right: auto;
  color: var(--text-muted);
}

/* ============================================================
   GRID / CARD LAYOUT
============================================================ */
.calc-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 22px;
  justify-content: center;
  margin-top: 14px;
}

/* Collapsible panels wrapper */
.calc-panel {
  width: 100%;
  margin-bottom: 10px;
}

/* Panel header with title + toggle */
.calc-panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}

.calc-panel-title {
  font-size: 0.95rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  color: var(--text-heading-strong);
}

.panel-toggle-btn {
  font-size: 0.78rem;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(120,160,190,0.7);
  background: transparent;
  color: var(--text-main);
  cursor: pointer;
}
.panel-toggle-btn:hover {
  background: rgba(102,252,241,0.12);
}

/* Panel body collapsible */
.calc-panel-body {
  transition: max-height 0.3s ease, opacity 0.3s ease;
  overflow: hidden;
}

.calc-panel.collapsed .calc-panel-body {
  max-height: 0;
  opacity: 0;
  pointer-events: none;
}

/* A generous default max-height so content fits before collapse */
.calc-panel:not(.collapsed) .calc-panel-body {
  max-height: 2000px;
  opacity: 1;
}

/* Calculator card itself */
.calc-card {
  flex: 1 1 260px;
  max-width: 100%;
  background: radial-gradient(circle at 0% 0%, rgba(102,252,241,0.12) 0, transparent 55%),
              radial-gradient(circle at 120% 120%, rgba(102,252,241,0.10) 0, transparent 55%),
              var(--bg-card);
  padding: 18px 20px 20px;
  border-radius: 16px;
  border: 1px solid var(--border-card);
  box-shadow: 0 0 22px rgba(102,252,241,0.12), var(--shadow-inner);
  transition: 0.25s ease;
  position: relative;
  overflow: hidden;
}
.calc-card::before {
  content: "";
  position: absolute;
  top: 0; left: 0;
  height: 3px;
  width: 100%;
  background: linear-gradient(
    to right,
    rgba(102,252,241,0.85),
    rgba(79,160,201,0.6),
    rgba(102,252,241,0.85)
  );
}
.calc-card:hover {
  border-color: rgba(102,252,241,0.28);
  transform: translateY(-2px);
}

/* Header row inside cards */
.calc-header-row {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  gap: 8px 12px;
  margin-bottom: 8px;
}

.calc-header-row h3 {
  margin: 0;
  font-size: 1rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--text-heading-strong);
}

/* Misc text */
.calc-note {
  font-size: 0.85rem;
  opacity: 0.9;
  margin-bottom: 10px;
}

/* ============================================================
   INPUTS + LABELS
============================================================ */
.calc-input-row {
  display: grid;
  gap: 8px 10px;
  grid-template-columns: 1fr 1fr;
}
@media (max-width: 700px) {
  .calc-input-row {
    grid-template-columns: 1fr;
  }
}

.calc-label {
  display: block;
  margin-bottom: 3px;
  font-size: 0.82rem;
  text-transform: uppercase;
  color: var(--text-heading);
  letter-spacing: 0.05em;
}

.calc-input {
  width: 100%;
  padding: 7px 10px;
  border-radius: 7px;
  border: 1px solid var(--border-input);
  background: var(--bg-input);
  color: var(--text-main);
  font-size: 0.9rem;
  box-sizing: border-box;
}
.calc-input:focus {
  outline: none;
  border-color: var(--text-accent);
}

/* Select shares style */
select.calc-input {
  padding-right: 26px;
}

/* ============================================================
   BUTTONS
============================================================ */
.calc-action-row {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 14px;
}

.calc-btn {
  background: linear-gradient(135deg, var(--btn-bg1), var(--btn-bg2));
  border: 1px solid var(--btn-border);
  border-radius: 999px;
  color: #031016;
  cursor: pointer;
  font-size: 0.86rem;
  font-weight: 500;
  letter-spacing: 0.04em;
  padding: 8px 16px;
  text-transform: uppercase;
  transition: transform 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
}
.calc-btn:hover {
  background: linear-gradient(135deg, #e6f6ff, #d7f0ff);
  box-shadow: 0 0 12px rgba(210,240,255,0.75);
  transform: translateY(-1px);
}
.calc-btn.secondary {
  background: transparent;
  border-color: rgba(140,200,255,0.7);
  color: var(--text-main);
}
.calc-btn.secondary:hover {
  background: rgba(10,20,32,0.9);
  color: #c8f3ff;
}

/* ============================================================
   OUTPUT BOXES
============================================================ */
.calc-output,
.calc-output-mini {
  margin-top: 12px;
  background: var(--bg-output);
  border: 1px solid var(--border-output);
  border-radius: 10px;
  padding: 10px;
  font-family: "JetBrains Mono", Menlo, Consolas, monospace;
  font-size: 0.8rem;
  white-space: pre-wrap;
  overflow-y: auto;
  max-height: 210px;
}
.calc-output-mini {
  max-height: 150px;
}

.calc-output.error {
  background: var(--error-bg);
  color: var(--error-text);
}

/* ============================================================
   FORMULA BOXES
============================================================ */
.calc-formula-box {
  margin-top: 10px;
  background: var(--bg-formula);
  border: 1px solid var(--border-formula);
  border-radius: 8px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease, opacity 0.3s ease;
  padding: 0 10px;
  opacity: 0;
}
.calc-formula-box.is-open {
  max-height: 260px;
  padding: 10px;
  opacity: 1;
}
.calc-formula-inner {
  overflow-x: auto;
}

/* ============================================================
   PRESET PILLS
============================================================ */
.calc-pill-row {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
}

.calc-pill {
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid var(--chip-border);
  font-size: 0.72rem;
  text-transform: uppercase;
  cursor: pointer;
  background: var(--chip-bg);
  color: var(--text-muted);
}
.calc-pill:hover {
  background: rgba(65,190,220,0.2);
}
.calc-pill.is-active {
  background: linear-gradient(135deg, var(--chip-bg-active1), var(--chip-bg-active2));
  color: var(--chip-text-active);
  border-color: rgba(200,240,255,0.9);
}

/* ============================================================
   ADVANCED FULL-WIDTH COMPARATOR
============================================================ */
.calc-card-wide {
  width: 100%;
  max-width: 100%;
  margin-top: 32px;
  background: radial-gradient(circle at 0% 50%, rgba(102,252,241,0.10) 0, transparent 70%),
              radial-gradient(circle at 100% 50%, rgba(102,252,241,0.08) 0, transparent 70%),
              var(--bg-card-wide);
  border-radius: 18px;
  border: 1px solid var(--border-card-wide);
  box-shadow:
      0 0 26px rgba(102,252,241,0.16),
      inset 0 0 22px rgba(102,252,241,0.06);
  padding: 28px 24px 32px;
  position: relative;
}

.calc-card-wide h3 {
  margin-top: 0;
  font-size: 1.05rem;
  text-transform: uppercase;
  letter-spacing: 0.04em;
  color: var(--text-heading-strong);
  margin-bottom: 10px;
}

.calc-card-wide canvas {
  width: 100%;
  height: 420px;
  max-height: 420px;
  margin-top: 16px;
  border-radius: 10px;
  background: rgba(0,0,0,0.25);
  padding: 8px;
  box-shadow:
      0 0 14px rgba(102,252,241,0.10),
      inset 0 0 12px rgba(102,252,241,0.05);
}

/* Info box under plot */
#adv-growth-info {
  margin-top: 16px;
}

/* Footnote */
.calc-footnote {
  font-size: 0.85rem;
  opacity: 0.9;
  margin-top: 20px;
  color: var(--text-muted);
}
</style>
</head>






  
<body id="top">

<!-- ================= HEADER WITH NAV + THEME TOGGLE ================= -->
<header class="site-header">
  <div class="site-header-left">
    <a href="index.html">← Back to Home</a>
    <a href="#top">Top</a>
  </div>
  <!-- Label shows the mode you can switch TO -->
  <button id="theme-toggle" class="theme-toggle" type="button">Light mode</button>
</header>

<div class="page">

  <!-- ================= TITLE ================= -->
  <h1>QKDE Interactive Calculator Suite</h1>
  <p class="center" style="opacity:0.9;">ΛCDM • QKDE • Growth • Kinetic Drift Tools</p>

  <p class="calc-intro">
    These tools implement exact GR background and linear-growth equations for simple dark-energy models,
    and a running kinetic normalization for QKDE. Use them to compare ΛCDM, constant-w quintessence,
    CPL-type k-essence, and QKDE’s kinetic drift at the level of <em>H(a)</em>, distances, and growth.
  </p>

  <!-- ============================================================
       PANEL 1: ΛCDM BACKGROUND
  ============================================================ -->
  <section class="calc-panel" id="panel-lcdm">
    <div class="calc-panel-header">
      <div class="calc-panel-title">ΛCDM background + distances</div>
      <button class="panel-toggle-btn" data-panel="panel-lcdm" type="button">Hide</button>
    </div>
    <div class="calc-panel-body">
      <article class="calc-card" id="lcdm-card">
        <div class="calc-header-row">
          <h3>ΛCDM Background &amp; Distances</h3>
          <div class="calc-pill-row">
            <button class="calc-pill is-active" data-preset="planck">Planck-like</button>
            <button class="calc-pill" data-preset="local">Local H₀</button>
          </div>
        </div>

        <h4>Flat ΛCDM reference</h4>
        <p class="calc-note">
          Computes \(H(z)\), comoving distance \(\chi(z)\), angular and luminosity distances,
          and SN distance modulus \(\mu(z)\) in a spatially-flat ΛCDM background.
        </p>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">Redshift z</label>
            <input id="lcdm-z" class="calc-input" type="number" value="0.5" step="0.01">
          </div>
          <div>
            <label class="calc-label">H₀ [km/s/Mpc]</label>
            <input id="lcdm-h0" class="calc-input" type="number" value="70" step="0.1">
          </div>
          <div>
            <label class="calc-label">Ωₘ₀</label>
            <input id="lcdm-om" class="calc-input" type="number" value="0.3" step="0.001">
          </div>
          <div>
            <label class="calc-label">Ωᵣ₀</label>
            <input id="lcdm-or" class="calc-input" type="number" value="0" step="1e-5">
          </div>
          <div>
            <label class="calc-label">ΩΛ₀</label>
            <input id="lcdm-ol" class="calc-input" type="number" value="0.7" step="0.001">
          </div>
          <div>
            <label class="calc-label">z-steps</label>
            <input id="lcdm-steps" class="calc-input" type="number" value="400" step="50" min="50">
          </div>
        </div>

        <div class="calc-action-row">
          <button class="calc-btn" id="lcdm-compute" type="button">Compute ΛCDM</button>
          <button class="calc-btn secondary" id="lcdm-formula-toggle" type="button">Show formulas</button>
        </div>

        <pre id="lcdm-output" class="calc-output"></pre>

        <!-- Formulas -->
        <div id="lcdm-formulas" class="calc-formula-box" aria-hidden="true">
          <div class="calc-formula-inner">
            <p>\(E(z)=\sqrt{\Omega_{m0}(1+z)^3 + \Omega_{r0}(1+z)^4 + \Omega_{\Lambda0}}\)</p>
            <p>\(H(z)=H_0 E(z)\)</p>
            <p>\(\chi(z)=c \int_0^z \frac{dz'}{H(z')}\)</p>
            <p>\(D_A=\chi/(1+z), \quad D_L=(1+z)\chi\)</p>
            <p>\(\mu = 5\log_{10}(D_L/\mathrm{Mpc}) + 25\)</p>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- ============================================================
       PANEL 2: QKDE RUNNING K
  ============================================================ -->
  <section class="calc-panel" id="panel-qkde">
    <div class="calc-panel-header">
      <div class="calc-panel-title">QKDE running kinetic normalization</div>
      <button class="panel-toggle-btn" data-panel="panel-qkde" type="button">Hide</button>
    </div>
    <div class="calc-panel-body">
      <article class="calc-card" id="qkde-card">
        <div class="calc-header-row">
          <h3>QKDE Running K</h3>
          <div class="calc-pill-row">
            <button class="calc-pill is-active" data-qkde-preset="mild">Mild drift</button>
            <button class="calc-pill" data-qkde-preset="strong">Strong drift</button>
          </div>
        </div>

        <h4>Running kinetic normalization</h4>
        <p class="calc-note">
          Implements \(K(N)=1+K_0 e^{-pN}\), with \(N=\ln a=-\ln(1+z)\). This encodes a slow background
          drift in the kinetic sector while the metric and growth equations remain exactly GR.
        </p>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">Redshift z</label>
            <input id="qkde-z" class="calc-input" value="0.5" type="number" step="0.01">
          </div>
          <div>
            <label class="calc-label">K₀</label>
            <input id="qkde-k0" class="calc-input" value="0.5" type="number" step="0.05">
          </div>
          <div>
            <label class="calc-label">p</label>
            <input id="qkde-p" class="calc-input" value="1.0" type="number" step="0.1">
          </div>
          <div>
            <label class="calc-label">Reference K(0)</label>
            <input id="qkde-kref" class="calc-input" value="1.0" type="number" step="0.01">
          </div>
        </div>

        <div class="calc-action-row">
          <button class="calc-btn" id="qkde-compute" type="button">Compute K(z)</button>
          <button class="calc-btn secondary" id="qkde-formula-toggle" type="button">Show definitions</button>
        </div>

        <pre id="qkde-output" class="calc-output"></pre>

        <div id="qkde-formulas" class="calc-formula-box" aria-hidden="true">
          <div class="calc-formula-inner">
            <p>\(N = -\ln(1+z)\)</p>
            <p>\(K(N) = 1 + K_0 e^{-pN}\)</p>
            <p>\(K'(N)/K(N) = -pK_0 e^{-pN}/K(N)\)</p>
            <p>Today (z=0, N=0): \(K(0)=1+K_0\)</p>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- ============================================================
       PANEL 3: GR GROWTH AT ONE REDSHIFT
  ============================================================ -->
  <section class="calc-panel" id="panel-growth">
    <div class="calc-panel-header">
      <div class="calc-panel-title">GR linear growth factor</div>
      <button class="panel-toggle-btn" data-panel="panel-growth" type="button">Hide</button>
    </div>
    <div class="calc-panel-body">
      <article class="calc-card" id="growth-card">
        <div class="calc-header-row">
          <h3>GR Growth D(a)</h3>
          <span class="calc-pill is-active" style="cursor:default;">GR Only</span>
        </div>

        <h4>Linear growth at the ΛCDM background</h4>
        <p class="calc-note">
          Solves the GR growth equation \(D'' + (2+H'/H)D' - \tfrac32 \Omega_m(a)D = 0\) in \(N=\ln a\)
          using the ΛCDM parameters from the first card. Growth is normalized to \(D(0)=1\).
        </p>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">Ωₘ₀ (growth)</label>
            <input id="grow-om0" class="calc-input" value="0.3" type="number" step="0.001">
          </div>
          <div>
            <label class="calc-label">Ωᵣ₀ (growth)</label>
            <input id="grow-or0" class="calc-input" value="0" type="number" step="1e-5">
          </div>
          <div>
            <label class="calc-label">ΩΛ₀ (growth)</label>
            <input id="grow-ol0" class="calc-input" value="0.7" type="number" step="0.001">
          </div>
          <div>
            <label class="calc-label">Use z from ΛCDM card</label>
            <input class="calc-input" value="linked" disabled>
          </div>
        </div>

        <div class="calc-action-row">
          <button class="calc-btn" id="grow-compute" type="button">Compute D(z)</button>
          <button class="calc-btn secondary" id="grow-formula-toggle" type="button">Show equation</button>
        </div>

        <pre id="grow-output" class="calc-output-mini"></pre>

        <div id="grow-formulas" class="calc-formula-box" aria-hidden="true">
          <div class="calc-formula-inner">
            <p>\( D'' + (2 + H'/H)D' - \frac{3}{2}\Omega_m(a)D = 0 \)</p>
            <p>where primes are derivatives with respect to \(N=\ln a\).</p>
          </div>
        </div>
      </article>
    </div>
  </section>

  <!-- ============================================================
       PANEL 4: ΛCDM vs QKDE AT ONE z
  ============================================================ -->
  <section class="calc-panel" id="panel-compare">
    <div class="calc-panel-header">
      <div class="calc-panel-title">ΛCDM vs QKDE snapshot</div>
      <button class="panel-toggle-btn" data-panel="panel-compare" type="button">Hide</button>
    </div>
    <div class="calc-panel-body">
      <article class="calc-card" id="compare-card">
        <div class="calc-header-row">
          <h3>ΛCDM vs QKDE</h3>
          <div class="calc-pill-row">
            <span class="calc-pill is-active" style="cursor:default;">Quick comparison</span>
          </div>
        </div>

        <h4>Snapshot comparison at one redshift</h4>
        <p class="calc-note">
          Compares ΛCDM distances with the QKDE kinetic normalization and GR growth at the same redshift.
          Uses ΛCDM parameters from the first card and QKDE parameters below.
        </p>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">Redshift z</label>
            <input id="cmp-z" class="calc-input" value="0.5" type="number" step="0.01">
          </div>
          <div>
            <label class="calc-label">K₀</label>
            <input id="cmp-k0" class="calc-input" value="0.5" type="number" step="0.05">
          </div>
          <div>
            <label class="calc-label">p</label>
            <input id="cmp-p" class="calc-input" value="1.0" type="number" step="0.1">
          </div>
          <div>
            <label class="calc-label">Reference K(0)</label>
            <input id="cmp-kref" class="calc-input" value="1.0" type="number" step="0.01">
          </div>
        </div>

        <div class="calc-action-row">
          <button class="calc-btn" id="cmp-compute" type="button">Compare at z</button>
        </div>

        <pre id="cmp-output" class="calc-output-mini"></pre>
      </article>
    </div>
  </section>

  <!-- ============================================================
       ADVANCED FULL-WIDTH COMPARATOR
  ============================================================ -->
  <section class="calc-panel" id="panel-advanced">
    <div class="calc-panel-header">
      <div class="calc-panel-title">Growth comparator: ΛCDM vs quintessence vs CPL vs QKDE</div>
      <button class="panel-toggle-btn" data-panel="panel-advanced" type="button">Hide</button>
    </div>
    <div class="calc-panel-body">
      <article class="calc-card-wide" id="advanced-growth-card">
        <h3>Growth Comparator (ΛCDM / Quintessence / CPL / QKDE)</h3>
        <p class="calc-note">
          Solves the GR growth equation for three standard background families
          (ΛCDM, constant-w quintessence, CPL \(w(a)=w_0+w_a(1-a)\)) and an
          effective QKDE background where \(H_{\rm QKDE}(a)=H_{\Lambda{\rm CDM}}(a)\sqrt{K(a)}\).
        </p>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">Ωₘ₀</label>
            <input id="adv-om0" class="calc-input" value="0.3" type="number" step="0.001">
          </div>
          <div>
            <label class="calc-label">Ωᵣ₀</label>
            <input id="adv-or0" class="calc-input" value="0" type="number" step="1e-5">
          </div>
          <div>
            <label class="calc-label">z<sub>max</sub></label>
            <input id="adv-zmax" class="calc-input" value="3" type="number" step="0.1">
          </div>
          <div>
            <label class="calc-label">Samples</label>
            <input id="adv-samples" class="calc-input" value="120" type="number" min="40" step="10">
          </div>
        </div>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">w<sub>Q</sub> (quintessence)</label>
            <input id="adv-wq" class="calc-input" value="-0.9" type="number" step="0.05">
          </div>
          <div>
            <label class="calc-label">w₀ (CPL)</label>
            <input id="adv-w0" class="calc-input" value="-0.9" type="number" step="0.05">
          </div>
          <div>
            <label class="calc-label">wₐ (CPL)</label>
            <input id="adv-wa" class="calc-input" value="0.2" type="number" step="0.05">
          </div>
          <div>
            <label class="calc-label">Models</label>
            <label><input type="checkbox" id="adv-show-lcdm" checked> ΛCDM</label><br>
            <label><input type="checkbox" id="adv-show-quint" checked> Quintessence</label><br>
            <label><input type="checkbox" id="adv-show-kess" checked> CPL-type k-essence</label><br>
            <label><input type="checkbox" id="adv-show-qkde" checked> QKDE (H×√K)</label>
          </div>
        </div>

        <div class="calc-input-row">
          <div>
            <label class="calc-label">x-axis</label>
            <select id="adv-xaxis" class="calc-input">
              <option value="a">Scale factor a</option>
              <option value="z">Redshift z</option>
            </select>
          </div>
          <div>
            <label class="calc-label">Normalization</label>
            <select id="adv-norm" class="calc-input">
              <option value="Da">D(a) with D(1)=1</option>
              <option value="Da_over_a">D(a)/a</option>
            </select>
          </div>
          <div>
            <label class="calc-label">K₀ (QKDE)</label>
            <input id="adv-k0q" class="calc-input" value="0.5" type="number" step="0.05">
          </div>
          <div>
            <label class="calc-label">p (QKDE)</label>
            <input id="adv-pq" class="calc-input" value="1.0" type="number" step="0.1">
          </div>
        </div>

        <div class="calc-action-row">
          <button class="calc-btn" id="adv-growth-compute" type="button">Plot growth</button>
        </div>

        <canvas id="adv-growth-canvas"></canvas>
        <pre id="adv-growth-info" class="calc-output-mini"></pre>

        <p class="calc-footnote">
          In this comparator, QKDE is treated as an effective background with
          \(H_{\rm QKDE}(a) = H_{\Lambda{\rm CDM}}(a)\sqrt{K(a)}\), where
          \(K(a)=1+K_0 e^{-p\ln a}\). Growth still follows the GR equation.
          This lets you directly see how a running kinetic normalization
          distorts \(D(a)\) relative to ΛCDM, quintessence, and CPL tracks.
        </p>
      </article>
    </div>
  </section>

</div> <!-- /page -->




  
<!-- ================= JS (put Section 3 here) ================= -->
<script>
/* ============================================================
   BASIC DOM HELPERS
============================================================ */
function byId(id) { return document.getElementById(id); }

function setOutput(el, text, isError = false) {
  if (!el) return;
  el.textContent = text;
  el.classList.toggle("error", isError);
}

/* Toggle formula box */
function attachFormulaToggle(btnId, boxId) {
  const btn = byId(btnId);
  const box = byId(boxId);
  if (!btn || !box) return;

  btn.addEventListener("click", () => {
    const open = box.classList.toggle("is-open");
    box.setAttribute("aria-hidden", open ? "false" : "true");
    btn.textContent = open ? "Hide formulas" : "Show formulas";
    if (window.MathJax && MathJax.typeset) MathJax.typeset([box]);
  });
}

/* Panel collapsible */
document.querySelectorAll(".panel-toggle-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const panel = document.getElementById(btn.dataset.panel);
    panel.classList.toggle("collapsed");
    btn.textContent = panel.classList.contains("collapsed") ? "Show" : "Hide";
  });
});




  
/* ============================================================
   THEME TOGGLE
============================================================ */
const themeToggle = byId("theme-toggle");
themeToggle.addEventListener("click", () => {
  const root = document.documentElement;
  const current = root.getAttribute("data-theme") || "dark";
  const next = current === "dark" ? "light" : "dark";
  root.setAttribute("data-theme", next);
  themeToggle.textContent = next === "dark" ? "Light mode" : "Dark mode";
});




  
/* ============================================================
   CORE COSMOLOGY FUNCTIONS
============================================================ */
function E_z(z, Om, Or, Ol) {
  return Math.sqrt(Om*(1+z)**3 + Or*(1+z)**4 + Ol);
}

function E_a(a, Om, Or, Ol) {
  return Math.sqrt(Om/a**3 + Or/a**4 + Ol);
}

function Omega_m(a, Om, Or, Ol) {
  const E = E_a(a, Om, Or, Ol);
  return (Om/a**3) / (E*E);
}

/* Simpson integral for comoving distance */
function integrateChi(H0, Om, Or, Ol, zmax, steps=400) {
  const c = 299792.458;
  const N = Math.max(50, steps);
  const dz = zmax/N;

  let sum = 0;
  for (let i = 0; i <= N; i++) {
    const z = i * dz;
    const w = (i === 0 || i === N ? 1 : (i % 2 === 0 ? 2 : 4));
    sum += w / E_z(z, Om, Or, Ol);
  }

  return (c/H0) * (dz/3) * sum;
}




  
/* ============================================================
   GR GROWTH SOLVER
============================================================ */
function solveGrowth(z, Om0, Or0, Ol0) {
  const a_target = 1/(1+z);
  const N_start = Math.log(1e-3);
  const N_end   = Math.log(a_target);
  const steps = 1200;
  const dN = (N_end - N_start) / steps;

  let D = Math.exp(N_start);
  let F = D;
  let N = N_start;

  function derivs(Nv, Dv, Fv) {
    const a = Math.exp(Nv);
    const E = E_a(a, Om0, Or0, Ol0);
    const E2 = E*E;
    const dlnH = (-3*Om0/a**3 - 4*Or0/a**4) / (2*E2);
    return {
      Dp: Fv,
      Fp: -(2 + dlnH)*Fv + 1.5*Omega_m(a, Om0, Or0, Ol0)*Dv
    };
  }

  function rkStep(Nv, Dv, Fv, h) {
    const k1 = derivs(Nv, Dv, Fv);
    const k2 = derivs(Nv + h/2, Dv + h*k1.Dp/2, Fv + h*k1.Fp/2);
    const k3 = derivs(Nv + h/2, Dv + h*k2.Dp/2, Fv + h*k2.Fp/2);
    const k4 = derivs(Nv + h,   Dv + h*k3.Dp,   Fv + h*k3.Fp);
    return {
      D: Dv + h*(k1.Dp + 2*k2.Dp + 2*k3.Dp + k4.Dp)/6,
      F: Fv + h*(k1.Fp + 2*k2.Fp + 2*k3.Fp + k4.Fp)/6
    };
  }

  for (let i=0;i<steps;i++) {
    const step = rkStep(N, D, F, dN);
    D = step.D;
    F = step.F;
    N += dN;
  }
  const D_target = D;
  const f = F/D;

  /* Normalize by computing D(0) */
  let D2 = Math.exp(N_start);
  let F2 = D2;
  let N2 = N_start;
  const steps2 = 1200, dN2 = -N_start/steps2;

  for (let i=0;i<steps2;i++) {
    const st = rkStep(N2, D2, F2, dN2);
    D2 = st.D; F2 = st.F;
    N2 += dN2;
  }

  return { Dnorm: D_target / D2, f };
}




  
/* ============================================================
   QKDE K(a)
============================================================ */
function K_a(a, K0, p) {
  const N = Math.log(a);
  return 1 + K0 * Math.exp(-p*N);
}




  
/* ============================================================
   CALCULATOR 1: ΛCDM BACKGROUND
============================================================ */
byId("lcdm-compute").addEventListener("click", () => {
  try {
    const z = parseFloat(byId("lcdm-z").value);
    const H0 = parseFloat(byId("lcdm-h0").value);
    const Om = parseFloat(byId("lcdm-om").value);
    const Or = parseFloat(byId("lcdm-or").value);
    const Ol = parseFloat(byId("lcdm-ol").value);
    const steps = parseInt(byId("lcdm-steps").value);

    const E = E_z(z, Om, Or, Ol);
    const H = H0 * E;
    const chi = integrateChi(H0, Om, Or, Ol, z, steps);
    const DA = chi/(1+z);
    const DL = chi*(1+z);
    const mu = 5*Math.log10(DL) + 25;

    setOutput(byId("lcdm-output"),
`H(z) = ${H.toFixed(4)} km/s/Mpc
χ(z) = ${chi.toFixed(4)} Mpc
D_A  = ${DA.toFixed(4)} Mpc
D_L  = ${DL.toFixed(4)} Mpc
μ     = ${mu.toFixed(4)}`);
  } catch (err) {
    setOutput(byId("lcdm-output"), err.message, true);
  }
});
attachFormulaToggle("lcdm-formula-toggle", "lcdm-formulas");




  
/* ============================================================
   CALCULATOR 2: QKDE K(z)
============================================================ */
byId("qkde-compute").addEventListener("click", () => {
  const z = parseFloat(byId("qkde-z").value);
  const K0 = parseFloat(byId("qkde-k0").value);
  const p  = parseFloat(byId("qkde-p").value);

  const a = 1/(1+z);
  const K = K_a(a, K0, p);

  setOutput(byId("qkde-output"),
`Scale factor a = ${a.toFixed(4)}
K(a) = ${K.toFixed(6)}
K(0) = ${1+K0}`);
});
attachFormulaToggle("qkde-formula-toggle", "qkde-formulas");




  
/* ============================================================
   CALCULATOR 3: GR GROWTH AT ONE z
============================================================ */
byId("grow-compute").addEventListener("click", () => {
  const z = parseFloat(byId("lcdm-z").value);
  const Om = parseFloat(byId("grow-om0").value);
  const Or = parseFloat(byId("grow-or0").value);
  const Ol = parseFloat(byId("grow-ol0").value);

  const g = solveGrowth(z, Om, Or, Ol);

  setOutput(byId("grow-output"),
`D(z) (normalized) = ${g.Dnorm.toFixed(6)}
f(z) = ${g.f.toFixed(6)}`);
});
attachFormulaToggle("grow-formula-toggle", "grow-formulas");



  
/* ============================================================
   CALCULATOR 4: ΛCDM vs QKDE SNAPSHOT
============================================================ */
byId("cmp-compute").addEventListener("click", () => {
  try {
    const z = parseFloat(byId("cmp-z").value);
    const Om = parseFloat(byId("lcdm-om").value);
    const Or = parseFloat(byId("lcdm-or").value);
    const Ol = parseFloat(byId("lcdm-ol").value);
    const H0 = parseFloat(byId("lcdm-h0").value);
    const K0 = parseFloat(byId("cmp-k0").value);
    const p  = parseFloat(byId("cmp-p").value);

    const a = 1/(1+z);

    const H_LCDM = H0 * E_z(z, Om, Or, Ol);
    const H_QKDE = H_LCDM * Math.sqrt(K_a(a, K0, p));

    const g_LCDM = solveGrowth(z, Om, Or, Ol);

    setOutput(byId("cmp-output"),
`H_LCDM(z) = ${H_LCDM.toFixed(4)}
H_QKDE(z) = ${H_QKDE.toFixed(4)}

K(a) = ${K_a(a, K0, p).toFixed(6)}

D_LCDM(z) = ${g_LCDM.Dnorm.toFixed(6)}
f_LCDM(z) = ${g_LCDM.f.toFixed(6)}`);
  } catch(err) {
    setOutput(byId("cmp-output"), err.message, true);
  }
});



  /* ============================================================
   ADVANCED FULL-WIDTH GROWTH COMPARATOR — FIXED VERSION
============================================================ */
let growthChart = null;

/* ------------------------------------------------------------
   Solve growth from scratch for each model
------------------------------------------------------------ */
function solveGrowthGeneric(aArray, E_func, Om0, Or0, Ol0) {

  const a_min = 1e-3;
  const N_start = Math.log(a_min);
  const steps = 1500;
  const dN = (0 - N_start)/steps;

  // initial conditions deep in matter era: D ~ a, D' = D
  let D = a_min;
  let F = D;
  let N = N_start;

  // cache results
  const results = [];
  let index = 0;

  function dlnH_dN(a) {
    const E = E_func(a);
    const epsilon = 1e-6;
    const ap = a * (1 + epsilon);
    const Ep = E_func(ap);
    return (Math.log(Ep) - Math.log(E)) / Math.log(1 + epsilon);
  }

  function derivs(Nv, Dv, Fv) {
    const a = Math.exp(Nv);
    const E = E_func(a);
    const OmA = (Om0 / (a*a*a)) / (E*E);
    const dlnH = dlnH_dN(a);
    return {
      Dp: Fv,
      Fp: -(2 + dlnH)*Fv + 1.5*OmA*Dv
    };
  }

  function rk(Nv, Dv, Fv, h) {
    const k1 = derivs(Nv, Dv, Fv);
    const k2 = derivs(Nv + h/2, Dv + h*k1.Dp/2, Fv + h*k1.Fp/2);
    const k3 = derivs(Nv + h/2, Dv + h*k2.Dp/2, Fv + h*k2.Fp/2);
    const k4 = derivs(Nv + h,   Dv + h*k3.Dp,   Fv + h*k3.Fp);
    return {
      D: Dv + h*(k1.Dp + 2*k2.Dp + 2*k3.Dp + k4.Dp)/6,
      F: Fv + h*(k1.Fp + 2*k2.Fp + 2*k3.Fp + k4.Fp)/6
    };
  }

  /* Integrate from N_start to N=0 */
  let a_target = aArray[index];

  while (index < aArray.length) {
    const N_target = Math.log(a_target);

    if (N < N_target - 1e-12) {
      const step = rk(N, D, F, dN);
      D = step.D; F = step.F;
      N += dN;
    } else {
      results.push(D);
      index++;
      if (index < aArray.length)
        a_target = aArray[index];
    }
  }

  // normalize so D(a=1)=1
  const D_today = results[results.length - 1];
  return results.map(x => x / D_today);
}

/* ------------------------------------------------------------
   ADVANCED COMPARATOR BUTTON
------------------------------------------------------------ */
byId("adv-growth-compute").addEventListener("click", () => {
  const Om0 = parseFloat(byId("adv-om0").value);
  const Or0 = parseFloat(byId("adv-or0").value);
  const zmax = parseFloat(byId("adv-zmax").value);
  const Npts = parseInt(byId("adv-samples").value);

  const wQ = parseFloat(byId("adv-wq").value);
  const w0 = parseFloat(byId("adv-w0").value);
  const wa = parseFloat(byId("adv-wa").value);
  const K0 = parseFloat(byId("adv-k0q").value);
  const p  = parseFloat(byId("adv-pq").value);

  const showLCDM = byId("adv-show-lcdm").checked;
  const showQ    = byId("adv-show-quint").checked;
  const showCPL  = byId("adv-show-kess").checked;
  const showQKDE = byId("adv-show-qkde").checked;

  /* Build scale-factor sampling */
  const a_min = 1/(1+zmax);
  const aArray = Array.from({length:Npts}, (_,i)=>
    a_min + i*(1-a_min)/(Npts-1)
  );

  /* Backgrounds */
  const Ol0 = 1 - Om0 - Or0;

  const E_LCDM = a =>
    Math.sqrt(Om0/a**3 + Or0/a**4 + Ol0);

  const E_Quint = a =>
    Math.sqrt(Om0/a**3 + Or0/a**4 + Ol0 * a**(-3*(1+wQ)));

  const E_CPL = a => {
    const ode = Ol0 * a**(-3*(1+w0+wa)) * Math.exp(-3*wa*(1-a));
    return Math.sqrt(Om0/a**3 + Or0/a**4 + ode);
  };

  const E_QKDE = a => {
    const K = 1 + K0 * a**(-p);
    return E_LCDM(a) * Math.sqrt(Math.max(K, 0));
  };

  /* Solve & plot */
  const datasets = [];

  if (showLCDM) datasets.push({
    label:"ΛCDM",
    data: solveGrowthGeneric(aArray, E_LCDM, Om0, Or0, Ol0),
    borderColor:"#66fcf1", tension:0.15
  });

  if (showQ) datasets.push({
    label:"Quintessence (w)",
    data: solveGrowthGeneric(aArray, E_Quint, Om0, Or0, Ol0),
    borderColor:"#ffb347", tension:0.15
  });

  if (showCPL) datasets.push({
    label:"CPL",
    data: solveGrowthGeneric(aArray, E_CPL, Om0, Or0, Ol0),
    borderColor:"#c07cff", tension:0.15
  });

  if (showQKDE) datasets.push({
    label:"QKDE (H×√K)",
    data: solveGrowthGeneric(aArray, E_QKDE, Om0, Or0, Ol0),
    borderColor:"#45d9a4", tension:0.15
  });

  const ctx = byId("adv-growth-canvas").getContext("2d");
  if (growthChart) growthChart.destroy();

  growthChart = new Chart(ctx, {
    type:"line",
    data:{ labels:aArray.map(a=>a.toFixed(3)), datasets },
    options:{
      responsive:true,
      scales:{
        x:{ title:{display:true, text:"Scale factor a"} },
        y:{ title:{display:true, text:"D(a) normalized"} }
      },
      plugins:{
        legend:{ labels:{ color:"white" }},
      }
    }
  });

  setOutput(byId("adv-growth-info"),
`Plotted:
${showLCDM ? "• ΛCDM\n" : ""}
${showQ    ? "• Quintessence\n" : ""}
${showCPL  ? "• CPL\n" : ""}
${showQKDE ? "• QKDE (H×√K)\n" : ""}`);
});
</script>




  
</body>
</html>
